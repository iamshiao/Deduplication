using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Deduplication.Controller.HashAlgorithm
{
    public class TripleHash
    {
        public string ComputeTripleHash(byte[] bytes)
        {
            UInt16 hash1 = 3;
            UInt16 hash2 = 37;
            UInt16 hash3 = 17;
            Int32 index = 0;
            foreach (byte b in bytes)
            {
                index++;
                if (index > 202) index -= 202;
                var tempHash1 = hash1 + (HF1[index] * b);
                hash1 = tempHash1 > UInt16.MaxValue ? (UInt16)(tempHash1 & UInt16.MaxValue) : (UInt16)tempHash1;
                var tempHash2 = hash2 + (HF2[index] * b);
                hash2 = tempHash2 > UInt16.MaxValue ? (UInt16)(tempHash2 & UInt16.MaxValue) : (UInt16)tempHash2;
                var tempHash3 = hash3 + (HF3[index] * b);
                hash3 = tempHash3 > UInt16.MaxValue ? (UInt16)(tempHash3 & UInt16.MaxValue) : (UInt16)tempHash3;
            }
            return ((long)hash1 * (long)hash2 * (long)hash3).ToString();
        }

        private UInt16[] HF1 = { 4395, 16639, 52975, 9038, 9337, 12201, 26055,
        48638, 29631, 60707, 57642, 50299, 11137, 6527, 51922, 57843, 22963, 16625,
        60946, 33442, 26920, 2836, 16802, 28683, 1514, 51220, 51791, 39639, 43729,
        32873, 22838, 28542, 47867, 34093, 45174, 55412, 57565, 10282, 10684,
        65530, 24109, 4727, 62013, 19764, 21521, 27536, 15312, 9261, 18204, 4999,
        59564, 30888, 15982, 50273, 62384, 64989, 3528, 2958, 40520, 17269, 19124,
        10628, 54020, 59694, 62835, 61349, 744, 7908, 20827, 40136, 38371, 61223,
        39495, 34203, 47549, 42637, 7981, 45828, 40226, 4021, 52857, 17234, 39536,
        64520, 38163, 30144, 48471, 30759, 37735, 1204, 36689, 34090, 10971, 43289,
        52117, 9310, 12857, 1985, 39913, 32678, 16244, 27597, 21607, 10199, 64937,
        27722, 28666, 56193, 52938, 26305, 58304, 59937, 36995, 27804, 44381, 51909,
        12777, 58415, 36166, 10588, 5856, 13507, 36905, 36001, 64635, 24773, 60488,
        14874, 27875, 7236, 34127, 60651, 38982, 31833, 1925, 60799, 20158, 8488,
        4901, 33262, 35972, 31435, 42865, 19607, 43619, 60140, 46440, 15253, 3378,
        33079, 9823, 4137, 4112, 35241, 56251, 7744, 55358, 29288, 64718, 37470,
        57791, 16118, 53389, 56920, 35902, 64364, 2901, 51485, 20896, 148, 17163,
        41438, 53228, 57225, 54617, 51181, 18540, 64635, 12609, 51530, 13215, 39489,
        24195, 26691, 50162, 308, 55553, 58011, 25253, 1068, 47499, 18726, 44845,
        10268, 17027, 60580, 65026, 21919, 1246, 56784, 20890, 31979, 5946 };

        private UInt16[] HF2 = { 36416, 55350, 1534, 45841, 56969, 51427, 64459,
        1255, 21120, 29183, 19965, 23914, 61065, 40167, 31337, 15451, 3056, 52854,
        6550, 14014, 10058, 14939, 22045, 899, 56847, 30127, 15634, 45550, 50602,
        26181, 7844, 46338, 9151, 32125, 51724, 49639, 19400, 29074, 29971, 28526,
        46569, 8395, 6668, 17273, 43414, 3099, 58298, 6850, 11385, 45023, 46684,
        44001, 53545, 17258, 23270, 31449, 65173, 2495, 49416, 45042, 22173, 4933,
        54651, 52377, 54714, 30488, 4512, 37584, 11376, 37850, 34131, 3647, 55463,
        19387, 43064, 7231, 48912, 40367, 32258, 41747, 11526, 11985, 54124, 44882,
        43150, 29332, 38168, 35487, 38542, 40804, 35049, 51890, 8970, 19809, 50190,
        5024, 40593, 39329, 24283, 51823, 4154, 42138, 58838, 7084, 30575, 34243,
        44853, 62046, 21929, 34452, 32752, 20272, 64013, 19766, 12621, 43372, 13360,
        14963, 40850, 49444, 37102, 53560, 51594, 43098, 17508, 7451, 741, 18017,
        23403, 41099, 34079, 27891, 44861, 25657, 16536, 43487, 5072, 12534, 24882,
        53051, 11353, 2354, 29633, 14483, 16694, 2360, 31327, 18940, 47785, 40271,
        37735, 29770, 46582, 15647, 32034, 17077, 32976, 1564, 34090, 57367, 54852,
        60227, 57320, 43264, 14097, 25353, 58340, 27277, 63949, 16311, 18504, 60797,
        34959, 4471, 16506, 41157, 15639, 16847, 2085, 20754, 52268, 49049, 48818,
        45112, 59064, 12037, 62869, 97, 34644, 38828, 19850, 27982, 24378, 23098,
        24208, 47983, 22415, 24506, 59430, 21930, 21859, 62295, 8246 };

        private UInt16[] HF3 = { 54454, 5158, 56681, 51827, 41367, 33400, 52564, 15528,
        51856, 20160, 1762, 38849, 41821, 1099, 45915, 23555, 36445, 44517, 64239,
        2859, 22738, 23614, 13439, 21527, 29795, 55202, 4924, 42172, 48441, 40309,
        3438, 24306, 42612, 39780, 55332, 31911, 63000, 25908, 30381, 10427, 51709,
        25844, 24752, 14943, 13862, 46102, 40799, 50511, 1880, 42501, 35930, 25341,
        40259, 31200, 6511, 50273, 36758, 65206, 18807, 9062, 8679, 49059, 3299,
        51578, 24941, 6996, 12437, 51221, 29316, 58205, 60925, 8854, 30361, 11894,
        1990, 16731, 22226, 12573, 5450, 32000, 36545, 17176, 25035, 36539, 33321,
        36786, 43793, 57271, 60039, 38986, 26519, 56446, 62782, 31752, 61546, 14164,
        59856, 32961, 14112, 14223, 62512, 5667, 46295, 19590, 48531, 20177, 42783,
        780, 34114, 56579, 26072, 18600, 3998, 62534, 38491, 63581, 63385, 41512,
        1670, 6644, 8100, 5265, 6623, 22427, 14460, 184, 46987, 8890, 1223, 41894,
        13900, 33151, 6584, 33641, 41777, 60146, 12340, 47402, 2786, 17243, 65156,
        16548, 32607, 26637, 48368, 38190, 14831, 19466, 59392, 37043, 451, 3184,
        14851, 19365, 9969, 11368, 11089, 46361, 35111, 3408, 44713, 36518, 42885,
        19429, 56391, 58070, 41650, 24788, 28296, 33375, 15957, 61333, 37343, 29195,
        24794, 30595, 18570, 52655, 4612, 47429, 1661, 4865, 47950, 38939, 41191,
        20740, 42693, 19984, 57612, 32414, 10563, 36266, 35420, 57056, 44918, 35897,
        54421, 62350, 13965, 24008, 27419, 50918, 12876 };
    }
}
